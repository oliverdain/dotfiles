- name: Get package facts
  package_facts:
    manager: "auto"
# Weused to use AppImgLauncher but it was buggy and intercepted any attempts to run an .AppImg which was annoying for
# command line tools. If we want a desktop integration tool we should probably move to
# https://github.com/mijorus/gearlever
- name: Ensure AppImgLauncher isn't installed.
  apt:
    name: appimagelauncher
    state: absent
# This sets the open files limit for things started via PAM (e.g. ssh login)
- name: Configure file descriptor limits in /etc/security/limits.conf
  blockinfile:
    path: /etc/security/limits.conf
    block: |
      * soft nofile 1048576
      * hard nofile 1048576
    marker: "# {mark} ANSIBLE MANAGED BLOCK - File descriptor limits"
    backup: yes
  become: yes
# the following two lines set the open files limit for things started by systemd which includes normal login shell and
# GUI.
- name: Set DefaultLimitNOFILE in /etc/systemd/system.conf
  lineinfile:
    path: /etc/systemd/system.conf
    regexp: '^DefaultLimitNOFILE='
    line: 'DefaultLimitNOFILE=1048576'
    state: present
    insertafter: EOF
    backup: true
  become: yes
- name: Set DefaultLimitNOFILE in /etc/systemd/user.conf
  lineinfile:
    path: /etc/systemd/user.conf
    regexp: '^DefaultLimitNOFILE='
    line: 'DefaultLimitNOFILE=1048576'
    state: present
    insertafter: EOF
    backup: true
  become: yes
